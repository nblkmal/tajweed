const u=[{border:"#10b981",badge:"#10b981"},{border:"#3b82f6",badge:"#3b82f6"},{border:"#8b5cf6",badge:"#8b5cf6"},{border:"#f59e0b",badge:"#f59e0b"},{border:"#ef4444",badge:"#ef4444"},{border:"#06b6d4",badge:"#06b6d4"},{border:"#ec4899",badge:"#ec4899"},{border:"#84cc16",badge:"#84cc16"},{border:"#f97316",badge:"#f97316"}];function p(){const r=document.getElementById("article");if(!r)return;Array.from(r.querySelectorAll("h3")).forEach((e,l)=>{const n=u[l%u.length],o=[];let a=e.nextElementSibling;for(;a&&a.tagName!=="H3"&&a.tagName!=="H2";){const t=a.nextElementSibling;if(a.tagName==="HR"){a.remove();break}o.push(a),a=t}const s=document.createElement("section");s.className="rule-card",s.style.borderLeftColor=n.border,s.dataset.rule=String(l+1),e.parentNode.insertBefore(s,e),s.appendChild(e),o.forEach(t=>s.appendChild(t));const i=e.textContent.match(/^(\d+)\./)?.[1];if(i){e.innerHTML=e.innerHTML.replace(/^\d+\.\s*/,"");const t=document.createElement("span");t.className="rule-badge",t.style.backgroundColor=n.badge,t.textContent=i,e.prepend(t)}s.querySelectorAll("blockquote p").forEach(t=>{/[\u0600-\u06FF]/.test(t.textContent)&&t.classList.add("arabic-text")})}),r.querySelectorAll("blockquote p").forEach(e=>{/[\u0600-\u06FF]/.test(e.textContent)&&e.classList.add("arabic-text")})}function h(){const r=document.getElementById("article"),c=document.getElementById("toc"),e=document.getElementById("mobile-jump-bar");if(!r||!c)return;const l=Array.from(r.querySelectorAll("h2, h3")),n=[];l.forEach((o,a)=>{const i=o.textContent.replace(/^\d+\.\s*/,"").split("(")[0].split("—")[0].split("–")[0].trim().toLowerCase().replace(/[^a-z0-9\s]/g,"").trim().replace(/\s+/g,"-").replace(/^-+|-+$/g,"").substring(0,50);o.id=i||`heading-${a}`;const t=o.tagName==="H3",d=document.createElement("a");d.href=`#${o.id}`,d.dataset.headingId=o.id;const b=o.textContent.replace(/^\d+\.\s*/,"").split("(")[0].split("—")[0].split("–")[0].trim();if(t){const f=o.textContent.match(/\d+/)?.[0],g=f?u[(parseInt(f)-1)%u.length]:u[0];d.className="toc-link flex items-center gap-2 px-2 py-1.5 rounded-lg text-stone-500 hover:text-stone-800 hover:bg-stone-100 transition-colors",d.innerHTML=`
              <span class="toc-badge flex-shrink-0 w-5 h-5 rounded-full text-white text-[10px] font-bold flex items-center justify-center" style="background-color:${g.badge}">${f||"·"}</span>
              <span class="truncate text-[13px]">${b}</span>
            `,n.push({id:o.id,label:b,num:f,color:g})}else d.className="toc-link flex items-center px-2 py-1.5 rounded-lg text-[11px] font-semibold uppercase tracking-wider text-stone-400 hover:text-stone-600 transition-colors mt-3 first:mt-0",d.textContent=b;c.appendChild(d)}),e&&n.length>0&&(e.style.removeProperty("display"),e.style.display="flex",n.forEach(({id:o,label:a,num:s,color:i})=>{const t=document.createElement("a");t.href=`#${o}`,t.className="mobile-chip flex-shrink-0 flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border transition-colors whitespace-nowrap",t.style.borderColor=i.badge+"40",t.style.color=i.badge,t.style.backgroundColor=i.badge+"10",t.innerHTML=a,e.appendChild(t)}))}function m(){const r=document.querySelector("nav"),c=document.getElementById("mobile-jump-bar");let e=r?r.offsetHeight:56;return c&&c.offsetHeight>0&&(e+=c.offsetHeight),e+16}function x(){const r=Array.from(document.querySelectorAll("#article h2, #article h3"));function c(){const l=window.scrollY+m()+10;let n=null;for(const o of r)if(o.getBoundingClientRect().top+window.scrollY<=l)n=o.id;else break;return n}function e(){const l=c();document.querySelectorAll(".toc-link").forEach(n=>{n.classList.toggle("active",n.dataset.headingId===l)}),document.querySelectorAll(".mobile-chip").forEach(n=>{const o=n.getAttribute("href")?.replace("#","");n.classList.toggle("chip-active",o===l)})}window.addEventListener("scroll",e,{passive:!0}),e()}function y(){document.addEventListener("click",r=>{const c=r.target.closest('a[href^="#"]');if(!c)return;r.preventDefault();const e=c.getAttribute("href").replace(/^#/,""),l=document.getElementById(e);l&&window.scrollTo({top:l.getBoundingClientRect().top+window.scrollY-m(),behavior:"smooth"})})}document.addEventListener("DOMContentLoaded",()=>{h(),p(),x(),y()});
